set serveroutput on;

CREATE SEQUENCE SEC_MATERIA
START WITH 1
INCREMENT BY 1
NOMAXVALUE;


CREATE TABLE ALUMNO(NUM_CUENTA INTEGER PRIMARY KEY, NOMBRE VARCHAR2(40), PATERNO VARCHAR2(40));

CREATE TABLE MATERIA (ID_MATERIA INTEGER, NOMBRE VARCHAR2(40), CONSTRAINT PK_ID_MATERIA PRIMARY KEY(ID_MATERIA));

CREATE TABLE EVALUACION (NUM_CUENTA INTEGER, ID_MATERIA INTEGER, CALIFICACION FLOAT, ESTATUS CHAR, 
CONSTRAINT FK1_NUM_CUENTA FOREIGN KEY(NUM_CUENTA) REFERENCES ALUMNO(NUM_CUENTA),
CONSTRAINT FK2_ID_MATERIA FOREIGN KEY(ID_MATERIA) REFERENCES MATERIA(ID_MATERIA));

CREATE OR REPLACE PROCEDURE GUARDAR_MATERIA(MY_ID_MATERIA OUT INTEGER, MY_NOMBRE IN VARCHAR2)
AS
BEGIN
SELECT SEC_MATERIA.NEXTVAL INTO MY_ID_MATERIA FROM DUAL;
INSERT INTO MATERIA VALUES (MY_ID_MATERIA, MY_NOMBRE);
END;
/

DECLARE 
VALOR INTEGER;
BEGIN
GUARDAR_MATERIA(VALOR,'METODOLOGIA ESTRUCTURADA');
END;
/

INSERT INTO ALUMNO VALUES(123,'JUAN','TORRES');
INSERT INTO ALUMNO VALUES(456,'DANIELA','MEZA');
INSERT INTO ALUMNO VALUES(789,'ARMANDO','C√ÅRDENAZ');

SELECT * FROM ALUMNO;
SELECT * FROM MATERIA;
DELETE FROM MATERIA WHERE ID_MATERIA = 2;

CREATE OR REPLACE TRIGGER DISP_EVALUACION BEFORE INSERT ON EVALUACION FOR EACH ROW 
BEGIN 
IF ESTATUS='A' AND ESTATUS='R' THEN
RAISE_APPLICATION_ERROR(-20001,'ERROR');



END IF;
END IF; 
END IF;
END;
/

CREATE OR REPLACE TRIGGER DISP_TRABAJADOR BEFORE INSERT ON TRABAJADOR FOR EACH ROW 
DECLARE
VALOR INTEGER;
BEGIN
CONTAR(VALOR);
IF VALOR=3 THEN
COPIA();
DELETE FROM TRABAJADOR;
END IF;
END;
/
